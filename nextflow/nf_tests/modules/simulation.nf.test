nextflow_process {

    name "Simulation module"
    script "modules/simulation.nf"
    process "SIMULATION"

    test("sim_b37_v1_ddx3x") {

        when {

            params {
                dnm = "$baseDir/nf_tests/test_data/simulation/b37/ensembl/input/DDD_RUMC_GDX_denovos_cadd_shet_wweights_2020_01_17.txt"
                rates = "$baseDir/nf_tests/test_data/simulation/b37/ensembl/input/DDX3X_rates_cadd_maf_shet_2020_03_05.txt.gz"
                weights = "$baseDir/nf_tests/test_data/simulation/b37/ensembl/input/weights_ppv_2020_01_17.tab"
                nmales = 17422
                nfemales = 13636
            }
            process {
                """
                input[0] = Channel.fromPath(params.dnm).combine(Channel.fromPath(params.rates)).combine(Channel.fromPath(params.weights))
                input[1] = params.nmales
                input[2] = params.nfemales
                """
            }
        }

        then {

            assert process.success

            // Test that the output matches the latest output
            assert snapshot(process.out).match()
            
            // Check that the output example is still up to date
            assert path(process.out.get(0).get(0)).md5 == path("$baseDir/../examples/simulation/b37/ensembl/output/DDX3X_enrichment_results.tsv").md5
        }
    }
}